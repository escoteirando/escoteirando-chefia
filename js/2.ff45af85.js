(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"013f":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"row items-center justify-evenly"},[o("login-component")],1)},a=[],n=o("60a3"),r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-card",{staticClass:"login-card",attrs:{bordered:""}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("Login mAPPa")])]),o("q-separator",{attrs:{inset:""}}),o("q-form",{ref:"login_form"},[o("q-card-section",[o("q-input",{attrs:{autofocus:"",label:"Usuário",rules:[function(t){return!!t||"Usuário é requerido"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"account_circle"}})]},proxy:!0}]),model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),o("q-input",{attrs:{type:"password",label:"Senha",rules:[function(t){return!!t||"Senha é requerida"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"password"}})]},proxy:!0}]),model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),o("div",{staticClass:"q-gutter-sm"},[o("q-checkbox",{attrs:{label:"Entendo os termos de uso deste site"},model:{value:t.ack,callback:function(e){t.ack=e},expression:"ack"}})],1)],1)],1),o("q-card-actions",{attrs:{vertical:""}},[o("q-btn",{attrs:{flat:""},on:{click:t.doLogin}},[t._v("Login")])],1)],1)},i=[],c=o("bc3a"),u=o.n(c),l=o("1a63");class d{constructor(){this.debugEnabled=!0,this.debugEnabled=!1}logWrap(t,e,o){e=`[${this.constructor.name}] ${e}`,o?t(e,o):t(e)}logInfo(t,e){this.logWrap(console.info,t,e)}logWarn(t,e){this.logWrap(console.warn,t,e)}logError(t,e){this.logWrap(console.error,t,e)}logDebug(t,e){this.debugEnabled&&this.logWrap(console.debug,t,e)}}class g extends d{get(t,e={},o={}){return new Promise(((s,a)=>{if(!l["a"].isLogged){const o={statusCode:401,data:null,message:"MAPPA AUTHORIZATION IS MISSING",request:{method:"GET",data:e,url:t},success:!1};return this.logError("GET",o),void a(o)}const n=[];for(const[t,o]of Object.entries(e))n.push(`${encodeURIComponent(t)}=${encodeURIComponent(o)}`);const r=0==n.length?"":"?"+n.join("&");let i;i=o?u.a.get(t+r,{params:o}):u.a.get(t+r),i.then((o=>{const a={data:o.data,message:o.statusText,statusCode:o.status,success:o.status>0&&o.status<400,request:{data:e,method:"GET",url:t}};this.logDebug("GET",a),s(a)})).catch((o=>{var s,n;const r=o.response,i={data:null===r||void 0===r?void 0:r.data,message:null!==(s=null===r||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",statusCode:null!==(n=null===r||void 0===r?void 0:r.status)&&void 0!==n?n:0,success:!1,request:{data:e,method:"GET",url:t}};this.logError("GET",i),a(i)}))}))}post(t,e={}){return new Promise(((o,s)=>{u.a.post(t,e).then((s=>{const a={data:s.data,message:s.statusText,statusCode:s.status,success:s.status>0&&s.status<400,request:{data:e,method:"POST",url:t}};this.logDebug("POST",a),o(a)})).catch((o=>{var a,n;const r=o.response,i={data:null===r||void 0===r?void 0:r.data,message:null!==(a=null===r||void 0===r?void 0:r.statusText)&&void 0!==a?a:"",statusCode:null!==(n=null===r||void 0===r?void 0:r.status)&&void 0!==n?n:0,success:!1,request:{data:e,method:"POST",url:t}};this.logError("POST",i),s(i)}))}))}}class h{constructor(t,e){this.type="LOGIN_REQUEST",this.username="",this.password="",this.username=t,this.password=e}}var p=o("06f9");class f extends g{login(t,e){return new Promise(((o,s)=>{const a=new h(t,e);this.post("/api/escotistas/login",a).then((t=>{const e=t.data;l["a"].setAuth(e),o(e)})).catch((t=>{s(t)}))}))}logout(){l["a"].clearAuth()}autoLogin(){l["a"].isLogged&&this.getEscotista(l["a"].auth.userId).then((t=>{this.logInfo("AutoLogin Escotista",t),this.getGrupo(l["a"].escotista.codigoGrupo,l["a"].escotista.codigoRegiao).then((t=>{this.logInfo("AutoLogin Grupo",t)})).catch((t=>{this.logError("AutoLogin Grupo",t)}))})).catch((t=>{this.logError("AutoLogin Escotista",t)}))}getEscotista(t){return new Promise(((e,o)=>{const s=Object(p["b"])(t);s?e(s):this.get(`/api/escotistas/${t}`).then((t=>{const o=t.data;l["a"].setEscotista(o),e(o)})).catch((t=>{o(t)}))}))}getGrupo(t,e){return new Promise(((o,s)=>{const a=Object(p["c"])(t,e);if(a)o(a);else{const a={filter:{where:{codigo:t,codigoRegiao:e}}};this.get("/api/grupos",{},a).then((t=>{const e=t.data[0];l["a"].setGrupo(e),o(e)})).catch((t=>{s(t)}))}}))}}const m=new f;var v=function(t,e,o,s){var a,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,e,o,s);else for(var i=t.length-1;i>=0;i--)(a=t[i])&&(r=(n<3?a(r):n>3?a(e,o,r):a(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};let b=class extends n["c"]{constructor(){super(...arguments),this.username="",this.password="",this.ack=!1,this.show_usage=!1}doLogin(){this.ack?this.username&&this.password?(console.log("MappaLoginServiceInstance",m),m.login(this.username,this.password).then((t=>{console.log("Login",t),this.$q.notify({message:"Login autorizado"}),m.getEscotista(t.userId).then((t=>{this.$q.notify({message:`Escotista:${t.nomeCompleto}`}),m.getGrupo(t.codigoGrupo,t.codigoRegiao).then((t=>{this.$q.notify({message:`Grupo Escoteiro: ${t.codigo}/${t.codigoRegiao} ${t.nome}`})})).catch((t=>{console.error("GET_GRUPO",t),this.$q.notify({type:"negative",message:"Ocorreu um erro ao obter o grupo"})}))})).catch((t=>{console.error("GET_ESCOTISTA",t),this.$q.notify({type:"negative",message:`Ocorreu um erro ao obter o escotista: ${JSON.stringify(t)}`})}))})).catch((t=>{401==t.statusCode?this.$q.notify({type:"negative",message:"Não autorizado. Verifique seu usuário e/ou senha"}):this.$q.notify({type:"negative",message:`Ocorreu um erro ao acessar o servidor de autenticação. [${t.statusCode}:${t.message}]`})}))):this.$q.notify({message:"Verifique as informações requeridas",icon:"warning_amber",color:"negative"}):this.$q.notify({message:"Você deve aceitar os termos de uso deste site",icon:"warning_amber",color:"negative",actions:[{label:"Mostre-me",color:"white",handler:()=>{this.$router.push("usage_terms")}}]})}};b=v([n["a"]],b);var E=b,T=E,w=(o("ede4"),o("2877")),O=o("f09f"),y=o("a370"),S=o("eb85"),A=o("0378"),q=o("27f9"),P=o("0016"),I=o("8f8e"),_=o("4b7e"),G=o("9c40"),C=o("eebe"),$=o.n(C),R=Object(w["a"])(T,r,i,!1,null,"aac5000c",null),L=R.exports;$()(R,"components",{QCard:O["a"],QCardSection:y["a"],QSeparator:S["a"],QForm:A["a"],QInput:q["a"],QIcon:P["a"],QCheckbox:I["a"],QCardActions:_["a"],QBtn:G["a"]});var j=function(t,e,o,s){var a,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,e,o,s);else for(var i=t.length-1;i>=0;i--)(a=t[i])&&(r=(n<3?a(r):n>3?a(e,o,r):a(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};let U=class extends n["c"]{};U=j([Object(n["a"])({components:{LoginComponent:L}})],U);var x=U,k=x,D=o("9989"),M=Object(w["a"])(k,s,a,!1,null,null,null);e["default"]=M.exports;$()(M,"components",{QPage:D["a"]})},"06f9":function(t,e,o){"use strict";o.d(e,"a",(function(){return i})),o.d(e,"b",(function(){return c})),o.d(e,"d",(function(){return u})),o.d(e,"c",(function(){return l})),o.d(e,"e",(function(){return d}));var s=o("18d6");const a="MAPPA_ESCOTISTA",n="MAPPA_LOGIN",r="MAPPA_GRUPO";function i(){const t=s["a"].getItem(n);return t&&t.validUntil>new Date?t:null}function c(t){const e=s["a"].getItem(a);return e&&e.codigo===t?e:null}function u(t){s["a"].set(a,t)}function l(t,e){const o=s["a"].getItem(r);return o&&o.codigo==t&&o.codigoRegiao==e?o:null}function d(t){s["a"].set(r,t)}},"1a63":function(t,e,o){"use strict";o.d(e,"a",(function(){return p}));var s=o("0613"),a=o("6fc5"),n=o("a748");class r{constructor(t){this.id=t.id,this.ttl=t.ttl,this.created=t.created,this.userId=t.userId,this.auth=t.id,this.validUntil=new Date(new Date(t.created).getTime()+1e3*t.ttl)}static FakeAuth(){const t={created:new Date,id:"1",ttl:86400,userId:1},e=new r(t);return console.log("FakeAuth",e),e}}var i=o("06f9"),c=function(t,e,o,s){var a,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,e,o,s);else for(var i=t.length-1;i>=0;i--)(a=t[i])&&(r=(n<3?a(r):n>3?a(e,o,r):a(e,o))||r);return n>3&&r&&Object.defineProperty(e,o,r),r};const u="MAPPA_LOGIN",l="Usuário não logado";function d(){let t=Object(i["a"])();return t?(console.log("getAuthFromStore",t),t):(t={auth:"",created:new Date(0),id:"",ttl:0,userId:0,validUntil:new Date(0)},new r(t))}function g(t){window.localStorage.setItem(u,JSON.stringify(t))}let h=class extends a["d"]{constructor(){super(...arguments),this.auth=d(),this.escotista={ativo:"",codigo:0,codigoAssociado:0,codigoFoto:0,codigoGrupo:0,codigoRegiao:"",nomeCompleto:"Guionardo Furlan",username:"guionardo"},this.grupo={codigo:32,codigoRegiao:"SC",nome:"Leões de Blumenau",codigoModalidade:0},this.secao={codigo:1,codigoRegiao:"SC",codigoGrupo:32,codigoTipoSecao:1,nome:"Alcatéia 1"}}SET_AUTH(t){this.auth=new r(t),console.log("SET_AUTH",t),g(this.auth)}setAuth(t){this.SET_AUTH(t),Object(n["b"])(t.id)}clearAuth(){const t={id:"",ttl:0,created:new Date(0),userId:0};this.SET_AUTH(t)}setEscotista(t){this.SET_ESCOTISTA(t)}SET_ESCOTISTA(t){Object(i["d"])(t),this.escotista=t}get isLogged(){return!!this.auth.auth&&this.auth.validUntil>new Date}setGrupo(t){this.SET_GRUPO(t)}SET_GRUPO(t){Object(i["e"])(t),this.grupo=t}get userName(){return this.isLogged?this.escotista.nomeCompleto||this.escotista.username:l}get grupoNome(){return this.isLogged?`${this.grupo.codigo}/${this.grupo.codigoRegiao} ${this.grupo.nome}`:l}get secaoNome(){return this.isLogged?`${this.secao.nome}`:l}};c([a["c"]],h.prototype,"SET_AUTH",null),c([a["a"]],h.prototype,"setAuth",null),c([a["a"]],h.prototype,"clearAuth",null),c([a["a"]],h.prototype,"setEscotista",null),c([a["c"]],h.prototype,"SET_ESCOTISTA",null),c([a["a"]],h.prototype,"setGrupo",null),c([a["c"]],h.prototype,"SET_GRUPO",null),h=c([Object(a["b"])({dynamic:!0,store:s["b"],namespaced:!0,name:"MappaLoginModule"})],h);const p=Object(a["e"])(h)},ae7d:function(t,e,o){},ede4:function(t,e,o){"use strict";o("ae7d")}}]);